<head>
  <link rel="stylesheet" href="consultorio.component.css">
</head>

<body>
  <div>
    <h1>Consultorio </h1>
    <hr>

    <div>
        <form [formGroup]="buscadorForm" (ngSubmit)="buscarPaciente($event)"> 
          <div class="form-row justify-content-start">
            <div class="form-inline">
              <div>
                <mat-form-field appearance="legacy">
                  <mat-label>Paciente id</mat-label>
                  <input matInput type="number" placeholder="Paciente id" 
                        formControlName="pacienteIdBusqueda" id="pacienteIdBusqueda">
                </mat-form-field> 
              </div> 
            </div>
            &nbsp; &nbsp; &nbsp;
            <div class="form-inline">
              <div>
                <mat-form-field appearance="legacy">
                  <mat-label>C&eacute;dula</mat-label>
                  <input matInput type="text" placeholder="C&eacute;dula" 
                        formControlName="cedulaBusqueda" id="cedulaBusqueda">
                </mat-form-field> 
              </div> 
            </div>
            <div class="align-self-center">
              <button type="submit" hidden="true" class="btn btn-success"><i class="fas fa-search"></i> Buscar</button>
            </div>
            <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
            <div>
              <button type="button" class="btn btn-warning" data-toggle="tooltip" data-placement="top" title="Limpiar"
                  (click)="limpiar($event)"><i class="fas fa-backspace"></i></button>
            </div>
            <div>
              <button type="button" class="btn btn-primary" data-toggle="tooltip" data-placement="top" title="Buscador de pacientes"
                  (click)="openModal(editProfileModal)"><i class="fas fa-search"></i></button>
            </div>
          </div>
        </form>
    </div>

    <nav>
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Datos Personales</a>
        <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Ficha M&eacute;dica</a>
        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Historial Cl&iacute;nico</a>
        <a class="nav-item nav-link" id="nav-contact-tab" data-toggle="tab" href="#nav-contact" role="tab" aria-controls="nav-contact" aria-selected="false">Tratamiento</a>
      </div>
    </nav>

    <div class="tab-content" id="nav-tabContent">
      <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
        <div> 
          <!--Modal buscador de pacientes-->
          <div class="row justify-content-center">
            <div class="col-lg-6">
              <div class="container">              
                <div class="row">                
                  <ng-template #editProfileModal let-modal>
                    <div class="modal-header">
                    <h3 class="modal-title" id="editProfileLabel">Buscador Pacientes</h3>
                    <button type="button" class="close" (click)="modal.dismiss()" aria-label="Close">
                          <span aria-hidden="true">&times;</span> 
                    </button>
                    </div>
                    <div *ngIf="alert" class="alert alert-danger alert-dismissible fade show" role="alert">
                          Debe ingresar como m&iacute;nimo un dato de b&uacute;squeda
                          <button type="button" (click)="cerrarAlert()" class="close" data-dismiss="alert" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                          </button>
                    </div>
                    <div class="modal-body">
                          <form [formGroup]="buscadorModalForm" (ngSubmit)="buscadorPacientes($event)">
                                <div class="form-row justify-content-center">
                                      <div>                                                                                                                                                          
                                            <mat-form-field appearance="legacy">
                                                  <mat-label>C&eacute;dula</mat-label>
                                                  <input matInput type="text" placeholder="C&eacute;dula" 
                                                        formControlName="cedula" id="cedula">
                                            </mat-form-field>                                                                                                                                                         
                                            <mat-form-field appearance="legacy">
                                                  <mat-label>Nombres</mat-label>
                                                  <input matInput type="text" placeholder="Nombres" 
                                                        formControlName="nombres" id="nombres">
                                            </mat-form-field>
                                            <mat-form-field appearance="legacy">
                                                  <mat-label>Apellidos</mat-label>
                                                  <input matInput type="text" placeholder="Apellidos" 
                                                        formControlName="apellidos" id="apellidos">
                                            </mat-form-field>
                                      </div>
                                      &nbsp;                                                                            
                                      <div class="align-self-center">
                                            <button type="submit" hidden="true" class="btn btn-success"><i class="fas fa-search"></i> Buscar</button>
                                            <button (click)="limpiarModal($event)" class="btn btn-warning"><i class="fas fa-backspace"></i> Limpiar</button>                                                                            
                                      </div>
                                </div>
                          </form>
                          <br>

                          <!--Tabla vacia-->
                          <div class="table-responsive table-hover">
                                <table datatable [dtOptions]="dtOptions" class="table-bordered"
                                *ngIf="!cargando && pacientes.length === 0">
                                      <thead>
                                            <tr class="table-primary">
                                                  <th>Id</th>
                                                  <th>C&eacute;dula</th>
                                                  <th>Nombres</th>
                                                  <th>Apellidos</th>
                                            </tr>
                                      </thead>                                                                                    
                                </table>
                          </div>
                          <div class="table-responsive table-hover">
                                <table datatable [dtOptions]="dtOptions" class="table-bordered"
                                      *ngIf="pacientes.length > 0">
                                      <thead>
                                            <tr  class="table-primary">
                                                  <th>Id</th>
                                                  <th>C&eacute;dula</th>
                                                  <th>Nombres</th>
                                                  <th>Apellidos</th>
                                            </tr>
                                      </thead>
                                      <tbody *ngIf="pacientes?.length != 0">
                                            <tr *ngFor="let paciente of pacientes" 
                                                  (click)="selectPaciente($event, paciente)">                                                                                                
                                                  <td>{{ paciente.pacienteId }}</td>
                                                  <td>{{ paciente.personas.cedula }}</td>
                                                  <td>{{ paciente.personas.nombres }}</td>
                                                  <td>{{ paciente.personas.apellidos }}</td>
                                            </tr>
                                      </tbody>
                                      <tbody *ngIf="cargando">
                                            <td></td>
                                            <td></td>
                                            <td><h4 class="alert-heading">Cargando</h4>
                                                  <p>
                                                        <i class="fa fa-sync-alt fa-spin fa-2x"></i>
                                                  </p>
                                                  <p class="mb-0">
                                                        Espere por favor
                                                  </p>
                                            </td>
                                            <td></td>
                                      </tbody>                                                                                    
                                </table>
                          </div>
                          <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" (click)="modal.dismiss()">Cerrar</button>
                          </div>
                    </div>
                  </ng-template>                             
                </div>
              </div>              
            </div>          
          </div>
          <br>
          <!-- Datos pacienteles-->
          <div class="row justify-content-center">
            <div class="col-lg-5">
              <div class="container">              
                <div class="row">                
                  <div class="col"><b>Persona id:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('personaId').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Nombres:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('nombres').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Apellidos:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('apellidos').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Fecha nacimiento:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('fechaNacimiento').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Edad:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('edad').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Sexo:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('sexo').value}}</div>                
                </div>
              </div>              
            </div>

            <div class="col-lg-5">
              <div class="container">
                <div class="row">                
                  <div class="col"><b>Estado Civil:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('estadoCivil').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Nacionalidad:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('nacionalidad').value}}</div>
                  <div class="w-100"></div>                
                  <div class="col"><b>Carrera:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('carreraId').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Departamento:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('departamentoId').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Dependencia:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('dependenciaId').value}}</div>
                  <div class="w-100"></div>
                  <div class="col"><b>Estamento:</b></div>
                  <div class="col">{{pacienteForm.get('personas').get('estamentoId').value}}</div>                
                </div>   
              </div>         
            </div>

            <div class="col-lg-2">
              <div class="container">
                <div class="row">                
                  <img src="../assets/images/user-circle-solid.svg" alt="..." class="img-thumbnail">                               
                </div>   
              </div>         
            </div>

          </div>
        </div>
        <br><br>     
          
        <div class="card">
          <h3 class="card-header" data-toggle="collapse" data-target="#collapseBuscador"
              aria-expanded="true" aria-controls="collapseBuscador">Direcciones y contactos</h3>  
          <div class="card-body collapse show" id="collapseBuscador">
            <div class="row justify-content-center">
              <div class="col-lg-6">
                <div class="col"><b>Direcci&oacute;n:</b></div>
                <div class="col">{{pacienteForm.get('personas').get('direccion').value}}</div>
                <div class="w-100"></div>
                <div class="col"><b>Tel&eacute;fono:</b></div>
                <div class="col">{{pacienteForm.get('personas').get('telefono').value}}</div>
                <div class="w-100"></div>
                <div class="col"><b>Celular:</b></div>
                <div class="col">{{pacienteForm.get('personas').get('celular').value}}</div>
                <div class="w-100"></div>
                <div class="col"><b>Email:</b></div>
                <div class="col">{{pacienteForm.get('personas').get('email').value}}</div>
              </div>

              <div class="col-lg-6">
                <div class="form-group">
                  <label><b>Observaciones: </b></label>
                  <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                </div>
              </div>

            </div>
          </div>
        </div>
        <br>
        <br>
      </div>
      <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">...</div>
      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">...</div>
      <div class="tab-pane fade" id="nav-contact" role="tabpanel" aria-labelledby="nav-contact-tab">...</div>
    </div>
  </div>
</body>